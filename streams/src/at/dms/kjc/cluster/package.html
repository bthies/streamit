<!--
  Copyright 2003 by the Massachusetts Institute of Technology.

  Permission to use, copy, modify, and distribute this
  software and its documentation for any purpose and without
  fee is hereby granted, provided that the above copyright
  notice appear in all copies and that both that copyright
  notice and this permission notice appear in supporting
  documentation, and that the name of M.I.T. not be used in
  advertising or publicity pertaining to distribution of the
  software without specific, written prior permission.
  M.I.T. makes no representations about the suitability of
  this software for any purpose.  It is provided "as is"
  without express or implied warranty.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" [
<!ELEMENT code - - (#PCDATA)>
]>
<html>
<head>
<title>Overview of at.dms.kjc.cluster</title>
</head>
<body>

<p>
The cluster backend for StreamIt generates
a set of threads that can be executed on a cluster of networked
computers or a SMP. For each splitter/joiner/filter
a threadX.cpp file is generated that contains code for the operator.
The threads are enumerated from 0 to N-1 (the mapping between 
operators and integers is maintained by the class {@link at.dms.kjc.cluster.NodeEnumerator}).

<p>
A file master.cpp contains the master thread that is executed on
each cluster node and invokes appropriate operator threads.
File 'Makefile.cluster' contains instructions about compiling the
C files generated by the cluster backend.

<p>
The mapping between operator threads and cluster machines is
defined in 'cluster-config.txt' file. File 'cluster-setup.txt'
contains the number of steady state iterations the stream 
program should execute (Note that this can be overridden by passing
'-i N' parameter to the 'run_cluster'). 

<p>
After executing 'make -f Makefile.cluster' a 'run_cluster' executable
is generated. This executable should be invoked on all machines
defined in 'cluster-config.txt'.

<p>
The file 'cluster.h' defines the checkpointing freqency. By default
the checkpointing is turned off. Files 'global.h' and 'global.cpp' 
contain static fields of the stream program. File 'structs.h' 
contains structures defined by the stream program.


<h3>Cluster Standalone</h3>

Cluster backend also generates fusion.h and fusion.cpp files that
can be used to compile a single thread version of a stream program
for execution on a uniprocessor. The fusion.cpp contains a method
that invokes work functions of the operators from a single thread.

If -cluster option is combined with -standalone then after executing
'make -f Makefile.cluster' a 'fusion' file will be generated instead
or 'run_cluster'.

Despite compiling for a single thread, the code is still split into 
files threadX.cpp.

If the <pre>-fusion</pre> switch is passed along with the <pre>-standalone</pre>
switch, then the usual fusion is performed, resulting in a minimal number
of threadX.cpp files.

<h3>Class Overview</h3>
<ul>
<li>
ClusterBackend - the main class invoked by the StreamIt compiler
<li>
FlatIRToCluster - gemerates C code for filters
<li>
ClusterCode - generates code for splitters and joiners
<li>
BuiltinsCodeGen - generate code for file reader, writer, identity 
and dummy sink
<li>
ClusterCodeGenerator - generates fragments of threadX.cpp files that are common for all operators
<li>
ClusterFusion - a fusion pass that fuses splitters and joiners to adjacent filters
<li>
FusionCode - generates fusion.h and fusion.cpp files for uniprocessor
<li>
ClusterUtils - some utility functions
<li>
DiscoverSchedule - finds an execution schedule using breadth first search
<li>
GenerateMasterDotCpp - generates master.cpp
<li>
GenerateMakefile - generates Makefile.cluster
<li>
GenerateConfigFile - generates cluster-config.txt
<li>
GenerateSetupFile - generates cluster-setup.txt
<li>
GenerateClusterDotH - generates cluster.h
<li>
GenerateGlobal - generates global.h and global.cpp files
<li>
NodeEnumerator - maintains mapping between operators and integers
<li>
RegisterStreams - detects all tapes in Flatgraph and their data types
<li>
NetStream - represents a tape between operators and data typee
<li>
Optimizer - performs some optimizations on filter
<li>
DetectConst - detects which fields are only modified by the init function of a filter
<li>
CodeEstimate - estimates size of code and locals of a filter
<li>
DataEstimate - estimates data working set and I/O buffer requirements for a filter
<li>
Estimator - forces reestimation of code and locals sizes
<li>
LatencyConstraint - a pairwise constraint due to a latency message
<li>
LatencyConstraints - a class that registers all pairwise latency constraints
<li>
IncreaseFilterMult - performs peek scaling (obsolete)

</body>
</html>
